## 🧠 99 / 99.9 / 99.99% ⇒ 每月/每年“允许宕机时间”公式表

> 计算公式：**Downtime = (1 − Availability) × Time**
> 我这里用：**每月=30天(720小时)**、**每年=365天(8760小时)**

| Availability |   允许宕机/每月（30天） |      允许宕机/每年（365天） |
| ------------ | -------------: | -----------------: |
| **99%**      | **7小时 12分 0秒** | **3天 15小时 36分 0秒** |
| **99.9%**    |    **43分 12秒** |    **8小时 45分 36秒** |
| **99.99%**   |     **4分 19秒** |        **52分 34秒** |

> 小提示：如果面试官用“按 31 天/月”或“按 365.25 天/年”，数会略有差异，但方法一样。

---

## 🔄 Availability “曲线”对比：单 EC2 vs ALB+ASG vs ECS Fargate

用白板友好的方式理解：**从单点 → 多AZ冗余 → 托管调度+自动自愈**，可用性和“恢复速度”一起提升。

### 1) 单 EC2（SPOF）

* **形状**：平时很稳，但一旦实例/宿主机/磁盘/网络出问题 → **直接全挂**
* **恢复**：依赖人工/脚本重启、换机、重挂盘
* **典型结果**：可用性“波动大”，长尾宕机时间更容易超 SLA

### 2) ALB + ASG（多实例冗余）

* **形状**：单实例挂了不等于服务挂（ALB 把流量切走）→ **掉点不掉线**
* **恢复**：ASG 自动拉起新实例，ALB health check 自动摘除故障实例
* **典型结果**：可用性明显提升，但仍要管 **OS/AMI/发布/伸缩策略**

### 3) ECS Fargate（Service 多任务 + 多AZ）

* **形状**：同样可以多副本 + 多AZ，且宿主机/运行时由 AWS 托管 → **故障域更小**
* **恢复**：任务级自愈（task 死了自动重拉），发布/回滚更快（镜像版本化）
* **典型结果**：在“同等冗余架构”下，**MTTR 通常更低**，更容易守住 SLA（尤其是发布/扩缩容期间）

白板“曲线”示意（越右越平滑）：

```text
可用性
^
|   单EC2:      ________      ______
|              |        |____|
|
|   ALB+ASG:   ______________________   （偶发抖动，但不中断为主）
|
|   Fargate:   ________________________  （更快自愈 + 发布更平滑）
+--------------------------------------------------> 时间
```

> 关键点：**高可用不是“永不挂”，而是“挂得更少 + 恢复更快”**。

---

## 🧪 5 道“服务没挂但 SLA 违约”的真实事故题（带标准答案）

> 这些都属于 **brownout（性能降级）/ partial outage（局部故障）**：系统“还活着”，但指标已违约。

### 1) **延迟暴涨**（最常见）

**场景**：API 仍返回 200，但 P95 从 200ms 飙到 5s（DB 慢查询/连接池打满/GC 抖动）。
**问**：算不算 SLA 违约？
✅ **算**（SLA 常含 latency SLO 或“成功请求在阈值内比例”）。

### 2) **健康检查通过，但核心路径失败**

**场景**：`/health` 只检查进程存活，真实下单接口因为下游支付超时大量失败（或降级为“排队中”）。
✅ **算**：对用户的关键交易不可用，属于功能性不可用。

### 3) **错误率很低但集中在关键用户/关键区域**

**场景**：只有某个 AZ / 某个国家线路 / 某个运营商出问题，整体 5xx 只有 0.5%，但该区域用户 30% 失败。
✅ **算**：SLA 往往按“请求”或“用户体验”衡量；局部高失败也可能触发 SLA（尤其是区域 SLA）。

### 4) **依赖服务限流导致大量 429 / 403**

**场景**：你服务进程正常，CPU 也正常，但调用 Cognito/支付/第三方 API 被限流，导致用户请求大量 429/失败重试。
✅ **算**：对外表现是不可用/不可靠；“我们没挂”不是免责。

### 5) **DNS/证书/路由问题**

**场景**：后端完全正常，但 Route 53 解析错误、证书过期、ALB listener 配错，导致用户根本连不上。
✅ **算**：用户无法访问就是不可用，SLA 直接炸穿。

---

如果你想把这套直接变成“面试口播”，我可以给你一段 **20 秒**的总结话术，把 **SLA/可用性/冗余/MTTR** 全串起来（很像 L4-L6 的表达方式）。
