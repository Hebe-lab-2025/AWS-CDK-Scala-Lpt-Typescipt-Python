## 🧾 `aws s3 sync build/ s3://xxx --delete` 正确命令

> React 产物通常在 `build/`（CRA）或 `dist/`（Vite）。你这里用 `build/`。

```bash
aws s3 sync ./build/ s3://YOUR_BUCKET_NAME/ --delete
```

常用增强版（更稳、信息更清楚）：

```bash
aws s3 sync ./build/ s3://YOUR_BUCKET_NAME/ --delete --exact-timestamps --only-show-errors
```

如果你有 AWS profile：

```bash
aws --profile YOUR_PROFILE s3 sync ./build/ s3://YOUR_BUCKET_NAME/ --delete
```

---

## 🔍 遇到 404 / 403：只检查这 3 个地方（最快定位）

### 1) **S3 Static Website Hosting 配置**

看你是不是用 **website endpoint** 访问（不是普通对象 URL）：

* **Index document** 是否是 `index.html`
* （可选）**Error document** 是否也设成 `index.html`（React SPA 路由必备，否则刷新子路由会 404）

> SPA 典型：Index = `index.html`，Error = `index.html`

---

### 2) **Bucket Policy / Public Access Block（最容易 403）**

403 最常见原因：

* Bucket 还开着 **Block Public Access**
* Bucket policy 没允许 `s3:GetObject` 到 `arn:aws:s3:::BUCKET/*`

检查思路：

* **Public access block**：是否阻止了公共读取
* **Bucket policy**：是否有允许读对象的 statement（Action `s3:GetObject` + Resource `.../*`）

---

### 3) **你上传的对象路径 & URL 是否对得上（最容易 404）**

404 最常见原因：

* `index.html` 没在 bucket 根目录（你 sync 到了子目录）
* 你访问的 URL 路径和对象 key 不一致（比如多了 `/build/`、少了 `/`）
* `aws s3 sync` 源目录写错（比如应该 `dist/` 你却 sync `build/`）

快速验证：

* bucket 根目录里必须能看到：`index.html`、`assets/` 或 `static/`

---

## 🧠 React build → S3 → 浏览器 最小流程图

```text
[React Project]
    |
    | npm run build
    v
[build/ folder]
(index.html + js/css assets)
    |
    | aws s3 sync ./build/ s3://BUCKET/ --delete
    v
[S3 Bucket Objects]
/index.html
/static/*   (or /assets/*)
    |
    | Browser requests:
    |  - GET /            -> index.html
    |  - GET /static/...  -> js/css
    v
[Browser]
Render index.html -> load JS/CSS -> React app runs
```

如果你告诉我你是 **S3 website endpoint** 还是 **CloudFront** 访问，我也能给你一套“404/403 的分支决策树”（哪个错会出现哪种状态码）。
