ä¸‹é¢æˆ‘**æŒ‰çœŸå®æ“ä½œé¡ºåº + ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåš**ï¼Œä¸€æ­¥ä¸€æ­¥ç»™ä½ è®²æ¸…æ¥šï¼ˆåã€Œè€ƒè¯• / å®æˆ˜éƒ½èƒ½ç”¨ã€çš„è§£é‡Šï¼‰ã€‚

---

## ä¸€ã€èƒŒæ™¯å…ˆè®²æ¸…æ¥šï¼ˆä½ ç°åœ¨åœ¨å¹²å˜›ï¼‰

ä½ åœ¨åšçš„æ˜¯ **AWS SAM éƒ¨ç½²**ï¼Œæœ¬è´¨æ˜¯ï¼š

> ç”¨ **CloudFormation** éƒ¨ç½² Lambda + API Gateway
> ä½† **Lambda çš„ä»£ç  / æ¨¡æ¿æ–‡ä»¶** éœ€è¦ **å…ˆæ”¾åˆ° S3**

æ‰€ä»¥ **S3 bucket æ˜¯å‰ç½®æ¡ä»¶ï¼ˆprerequisiteï¼‰**ã€‚

---

## äºŒã€SAM å¦‚ä½•å¤„ç†æ¨¡æ¿æ–‡ä»¶ï¼ˆä¸¤ç§æ–¹å¼ï¼‰

SAM åœ¨ `sam deploy` æ—¶ï¼Œ**å¿…é¡»æœ‰ä¸€ä¸ª S3 bucket** æ¥å­˜æ”¾æ‰“åŒ…åçš„æ¨¡æ¿å’Œä»£ç ã€‚

### æ–¹å¼ 1ï¼š`--resolve-s3`ï¼ˆè‡ªåŠ¨å»º bucketï¼‰

```bash
sam deploy --resolve-s3
```

* SAM **è‡ªåŠ¨åˆ›å»ºå¹¶ç®¡ç†**ä¸€ä¸ª S3 bucket
* é€‚åˆï¼šå¿«é€Ÿ demo / ä¸æƒ³ç®¡ç»†èŠ‚
* ç¼ºç‚¹ï¼š**ä½ ä¸çŸ¥é“ bucket åå­—ï¼Œå—æ§æ€§å·®**

---

### æ–¹å¼ 2ï¼š`--s3-bucket`ï¼ˆç”¨å·²æœ‰ bucketï¼‰âœ…ï¼ˆæœ¬ lab ç”¨çš„ï¼‰

```bash
sam deploy --s3-bucket my-existing-bucket
```

* ä½  **æ˜ç¡®æŒ‡å®š** ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ S3 bucket
* é€‚åˆï¼šå®éªŒ / ä¼ä¸šç¯å¢ƒ / è€ƒè¯•
* **å‰æ**ï¼šä¸èƒ½å†ç”¨ `resolve_s3=true`

ğŸ‘‰ æ‰€ä»¥ **æœ¬å®éªŒé€‰æ‹©æ–¹å¼ 2**

---

## ä¸‰ã€ä¸ºä»€ä¹ˆè¦å» S3 æ§åˆ¶å°æ‰¾ bucketï¼Ÿ

### æ“ä½œ

1. æ‰“å¼€ **AWS Management Console**
2. æœç´¢ **S3**
3. ç‚¹å‡» **Buckets**
4. æ‰¾åˆ°å‰ç¼€æ˜¯ï¼š

   ```
   sam-clab-bucket-
   ```
5. **å¤åˆ¶å®Œæ•´ bucket åç§°**

### åŸå› ï¼ˆå¾ˆé‡è¦ï¼‰

* **S3 bucket åæ˜¯å…¨å±€å”¯ä¸€**
* SAM / CloudFormation **å¿…é¡»ç²¾ç¡®åŒ¹é…åå­—**
* å°‘ä¸€ä¸ªå­—ç¬¦éƒ½ä¼šå¤±è´¥

---

## å››ã€ä¸ºä»€ä¹ˆè¦æ”¹ `samconfig.toml`ï¼Ÿ

### æ‰“å¼€é…ç½®æ–‡ä»¶

```bash
nano samconfig.toml
```

### æ‰¾åˆ°è¿™ä¸€æ®µ

```toml
[default.deploy.parameters]
resolve_s3 = true
```

### æ”¹æˆ

```toml
resolve_s3 = false
```

### ä¸ºä»€ä¹ˆå¿…é¡»è¿™æ ·åšï¼Ÿ

> **è§„åˆ™ï¼š**
>
> * `--s3-bucket` å’Œ `resolve_s3=true` **ä¸èƒ½åŒæ—¶å­˜åœ¨**
> * å¦åˆ™ SAM ä¸çŸ¥é“ï¼š
>
>   * æ˜¯ä½ æŒ‡å®š bucketï¼Ÿ
>   * è¿˜æ˜¯å®ƒè‡ªå·±å»ºï¼Ÿ

ğŸ‘‰ æ‰€ä»¥ **æ˜ç¡®å‘Šè¯‰ SAMï¼šæˆ‘è‡ªå·±æŒ‡å®š bucket**

---

## äº”ã€çœŸæ­£éƒ¨ç½²ï¼ˆsam deploy åœ¨å¹²å˜›ï¼‰

### å‘½ä»¤ç»“æ„è§£é‡Š

```bash
sam deploy \
  --stack-name clab-stack \
  --s3-bucket <TEMPLATE-BUCKET-NAME> \
  --capabilities CAPABILITY_IAM
```

---

### 1ï¸âƒ£ `--stack-name clab-stack`

* CloudFormation çš„ **Stack åç§°**
* è¡Œä¸ºï¼š

  * å·²å­˜åœ¨ â†’ **æ›´æ–°**
  * ä¸å­˜åœ¨ â†’ **æ–°å»º**

ğŸ‘‰ ç­‰ä»·äºï¼š

> â€œç”¨ clab-stack è¿™ä¸ªåå­—ç®¡ç†æ‰€æœ‰èµ„æºâ€

---

### 2ï¸âƒ£ `--s3-bucket <TEMPLATE-BUCKET-NAME>`

* æŒ‡å®š **å­˜æ”¾æ¨¡æ¿å’Œ Lambda ä»£ç çš„ S3 bucket**
* SAM ä¼šè‡ªåŠ¨ï¼š

  * æ‰“åŒ…ä»£ç 
  * ä¸Šä¼ åˆ°è¿™ä¸ª bucket
  * ç”Ÿæˆ CloudFormation æ¨¡æ¿å¼•ç”¨è¿™äº›å¯¹è±¡

---

### 3ï¸âƒ£ `--capabilities CAPABILITY_IAM`

* **éå¸¸å…³é”®**
* è¡¨ç¤ºä½ å…è®¸ CloudFormationï¼š

  * åˆ›å»º / ä¿®æ”¹ **IAM Role / Policy**

å¦‚æœä¸åŠ  â†’ ç›´æ¥æŠ¥é”™ âŒ

---

## å…­ã€ä¸ºä»€ä¹ˆè¦è¾“å…¥ `y`ï¼Ÿ

å½“ä½ çœ‹åˆ°æç¤ºï¼š

```
Deploy this changeset? [y/N]:
```

è¯´æ˜ï¼š

* CloudFormation å·²ç»ç”Ÿæˆ **Change Set**
* åˆ—å‡ºäº†ï¼š

  * è¦åˆ›å»ºçš„ Lambda
  * API Gateway
  * IAM Role

ğŸ‘‰ è¾“å…¥ `y` = **ç¡®è®¤æ‰§è¡Œ**

---

## ä¸ƒã€éƒ¨ç½²å®Œæˆåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿï¼ˆç»“æœéªŒè¯ï¼‰

æˆåŠŸåï¼ŒSAM å·²å¸®ä½ è‡ªåŠ¨åˆ›å»ºï¼š

âœ… **Lambda Function**
âœ… **API Gateway**
âœ… **IAM Role**

å¹¶åœ¨ç»ˆç«¯è¾“å‡ºä¸­ç»™ä½ ï¼š

* **API Gateway Invoke URL**
* **Lambda ARN**
* **IAM Role ARN**

---

## å…«ã€æœ€åä¸€æ­¥ï¼šéªŒè¯åŠŸèƒ½

### æ“ä½œ

1. å¤åˆ¶ **Invoke URL**
2. ç²˜åˆ°æµè§ˆå™¨

### é¢„æœŸç»“æœ

```
hello
```

ğŸ‘‰ è¯´æ˜ï¼š

* API Gateway æ­£å¸¸
* Lambda è¢«æˆåŠŸè§¦å‘
* IAM æƒé™æ²¡é—®é¢˜
* SAM éƒ¨ç½²å®Œæ•´æˆåŠŸ

---

## ä¸€å¥è¯æ€»ç»“ï¼ˆé¢è¯• / è€ƒè¯•ç‰ˆï¼‰

> SAM éƒ¨ç½²æ—¶å¿…é¡»æœ‰ S3 å­˜æ”¾æ¨¡æ¿ï¼›
> ä½¿ç”¨ `--s3-bucket` æ—¶è¦å…³é—­ `resolve_s3`ï¼›
> `sam deploy` å®é™…æ˜¯åœ¨ç”¨ CloudFormation åˆ›å»º Lambdaã€API Gateway å’Œ IAM èµ„æºã€‚

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ä¸‹ä¸€æ­¥å¸®ä½ ï¼š

* ğŸ”¥ æŠŠ **sam deploy â†’ CloudFormation â†’ Lambda æ‰§è¡Œé“¾**ç”»æˆä¸€å¼  ASCII å›¾
* ğŸ§ª å‡º **3 é“ SAM / CloudFormation æ˜“é”™é¢˜ï¼ˆçœŸè€ƒé£ï¼‰**
* ğŸ§  ç”¨ **ä¸€å¥å£è¯€**æ•™ä½ ç§’é€‰ `resolve-s3 vs s3-bucket`
